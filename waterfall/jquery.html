<!DOCTYPE>
<html>
	<head>
		<title>jquery实现瀑布流布局</title>
		<meta charset="utf-8" />
		<script type="text/javascript" src="http://libs.baidu.com/jquery/1.9.0/jquery.js"></script>
		<script>
			$(window).on('load',function () {
				waterfall();
				var dataInt = {'data':[{"src":'31297.jpg'},{"src":'27265.jpg'},{"src":'100452.jpg'},{"src":'24014.jpg'},{"src":"189766.jpg"},{"src":"139622.jpg"},{"src":"65671.jpg"},{"src":"69596.jpg"},{"src":"133972.jpg"},{"src":"211168.jpg"},{"src":"2790.jpg"},{"src":"6401.jpg"},{"src":"111620.jpg"},{"src":"9099.jpg"},{"src":"90940.jpg"},{"src":"38046.jpg"},{"src":"41291.jpg"},{"src":"132380.jpg"},{"src":"50312.jpg"},{"src":"120412.jpg"},{"src":"20233.jpg"},{"src":"33344.jpg"}]};
				$(window).on('scroll', function(){
					if(checkScrollSlide()){
						$.each(dataInt.data,function(key,value) {
							var oBox=$('<div>').addClass('box').appendTo($('#main'));
							var oPic=$('<div>').addClass('pic').appendTo($(oBox));
							$('<img>').attr('src','http://wallpapers.wallhaven.cc/wallpapers/full/wallhaven-'+$(value).attr('src')).appendTo($(oPic));
						})
						waterfall();
					}
				})
			})
			function waterfall () {
				var $boxs=$('#main>div');
				var w=$boxs.eq(0).outerWidth();
				var cols=Math.floor($(window).width()/w);
				$('#main').width(cols*w).css('margin','0 auto');
				var hArr = [];
				$boxs.each(function(index,value) {
					var h=$boxs.eq(index).outerHeight();
					if(index<cols){
						hArr[index]=h;
					}else{
						var minH=Math.min.apply(null, hArr);
						var minHIndex=$.inArray(minH, hArr);
						$(value).css({
							'position':'absolute',
							'top':minH+'px',
							'left':minHIndex*w+'px'
						})
						hArr[minHIndex]+=$boxs.eq(index).outerHeight();
					}
				})
			}
			function checkScrollSlide () {
				var $lastBox=$('#main>div').last();
				var lastBoxDis=$lastBox.offset().top+Math.floor($lastBox.outerHeight()/2);
				var scrollTop=$(window).scrollTop();
				var documentH=$(window).height();
				return (lastBoxDis<scrollTop+documentH)?true:false;
			}
		</script>
		<style>
			*{margin: 0;padding: 0;}
			#main{position: relative;}
			.box{padding: 15px 0 0 15px;float:left; }
			.pic{padding: 10px;border: 1px solid #ccc;border-radius: 5px;box-shadow: 0 0 5px #ccc;}
			.pic img{width: 350px;height: auto;}
		</style>
	</head>
	<body>
		<div id="main">
			<div class="box"><div class="pic"><img src="http://wallpapers.wallhaven.cc/wallpapers/full/wallhaven-14.jpg" /></div></div>
			<div class="box"><div class="pic"><img src="http://wallpapers.wallhaven.cc/wallpapers/full/wallhaven-21.jpg" /></div></div>
			<div class="box"><div class="pic"><img src="http://wallpapers.wallhaven.cc/wallpapers/full/wallhaven-26.jpg" /></div></div>
			<div class="box"><div class="pic"><img src="http://wallpapers.wallhaven.cc/wallpapers/full/wallhaven-52.jpg" /></div></div>
			<div class="box"><div class="pic"><img src="http://wallpapers.wallhaven.cc/wallpapers/full/wallhaven-57.jpg" /></div></div>
			<div class="box"><div class="pic"><img src="http://wallpapers.wallhaven.cc/wallpapers/full/wallhaven-83.jpg" /></div></div>
			<div class="box"><div class="pic"><img src="http://wallpapers.wallhaven.cc/wallpapers/full/wallhaven-88.jpg" /></div></div>
			<div class="box"><div class="pic"><img src="http://wallpapers.wallhaven.cc/wallpapers/full/wallhaven-95.jpg" /></div></div>
			<div class="box"><div class="pic"><img src="http://wallpapers.wallhaven.cc/wallpapers/full/wallhaven-108.jpg" /></div></div>
			<div class="box"><div class="pic"><img src="http://wallpapers.wallhaven.cc/wallpapers/full/wallhaven-115.jpg" /></div></div>
			<div class="box"><div class="pic"><img src="http://wallpapers.wallhaven.cc/wallpapers/full/wallhaven-30852.jpg" /></div></div>
			<div class="box"><div class="pic"><img src="http://wallpapers.wallhaven.cc/wallpapers/full/wallhaven-35061.jpg" /></div></div>
			<div class="box"><div class="pic"><img src="http://wallpapers.wallhaven.cc/wallpapers/full/wallhaven-139463.jpg" /></div></div>
			<div class="box"><div class="pic"><img src="http://wallpapers.wallhaven.cc/wallpapers/full/wallhaven-18992.jpg" /></div></div>
			<div class="box"><div class="pic"><img src="http://wallpapers.wallhaven.cc/wallpapers/full/wallhaven-78725.jpg" /></div></div>
			<div class="box"><div class="pic"><img src="http://wallpapers.wallhaven.cc/wallpapers/full/wallhaven-181724.jpg" /></div></div>
			<div class="box"><div class="pic"><img src="http://wallpapers.wallhaven.cc/wallpapers/full/wallhaven-228478.jpg" /></div></div>
			<div class="box"><div class="pic"><img src="http://wallpapers.wallhaven.cc/wallpapers/full/wallhaven-105039.jpg" /></div></div>
			<div class="box"><div class="pic"><img src="http://wallpapers.wallhaven.cc/wallpapers/full/wallhaven-26293.jpg" /></div></div>
			<div class="box"><div class="pic"><img src="http://wallpapers.wallhaven.cc/wallpapers/full/wallhaven-46001.jpg" /></div></div>
			<div class="box"><div class="pic"><img src="http://wallpapers.wallhaven.cc/wallpapers/full/wallhaven-69541.jpg" /></div></div>
			<div class="box"><div class="pic"><img src="http://wallpapers.wallhaven.cc/wallpapers/full/wallhaven-103045.jpg" /></div></div>
			<div class="box"><div class="pic"><img src="http://wallpapers.wallhaven.cc/wallpapers/full/wallhaven-157167.jpg" /></div></div>
			<div class="box"><div class="pic"><img src="http://wallpapers.wallhaven.cc/wallpapers/full/wallhaven-127817.jpg" /></div></div>
			<div class="box"><div class="pic"><img src="http://wallpapers.wallhaven.cc/wallpapers/full/wallhaven-200849.jpg" /></div></div>
			<div class="box"><div class="pic"><img src="http://wallpapers.wallhaven.cc/wallpapers/full/wallhaven-31002.jpg" /></div></div>
			<div class="box"><div class="pic"><img src="http://wallpapers.wallhaven.cc/wallpapers/full/wallhaven-184901.jpg" /></div></div>
			<div class="box"><div class="pic"><img src="http://wallpapers.wallhaven.cc/wallpapers/full/wallhaven-199486.jpg" /></div></div>
			<div class="box"><div class="pic"><img src="http://wallpapers.wallhaven.cc/wallpapers/full/wallhaven-62514.jpg" /></div></div>
			<div class="box"><div class="pic"><img src="http://wallpapers.wallhaven.cc/wallpapers/full/wallhaven-136522.jpg" /></div></div>
		</div>
	</body>
</html>
